<!DOCTYPE html>
<html lang="fr">
{{template "InitPage" .}}
<body>
     <!-- Header -->
   {{template "AdminHeader" .}}

     <div class="main-container">
        <!-- Sidebar -->
       {{template "AdminSidebar" .}}

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <h1>GÃ©rer les catÃ©gories ({{.Stats.TotalCats}})</h1>
            </div>

<input type="text" class="search-box" placeholder="search">

<div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nom de la catÃ©gorie</th>
                            <th>Description</th>
                            <th>Actions</th>
                          
                        </tr>
                    </thead>
                    <tbody>
                    {{ range .Categories}}   
                     <tr>

                         <form method="POST" id="editcat{{.ID}}">
                                <input type="hidden" name="catID" value="{{.ID}}">
                            <td><span class="userfield"> {{.Name}} </span><input type="text" name="name" value="{{.Name}}" class="is-hidden user-edit"></td>
                            <td> 
                               <span class="userfield">{{.Description}} </span>
                               <textarea name="description" class="is-hidden user-edit">{{.Description}}</textarea>
                            <button type="submit" title="Valider les modifications" class="validate-btn is-hidden">âœ… Valider</button></td>
                            </form>

                            <td class="actions-column">
                        <div class="menu">
                            <div class="menu-options">
                               <a title="Modifier la catÃ©gorie" class="modifier-btn">ðŸ”§ Modifier</a>
                               <form method="POST" class="delete-form">
                                        <input type="hidden" name="catToDelete" value="{{.ID}}">
                                        <button title="Supprimer la catÃ©gorie" 
                                        type="button" class="delete-btn" 
                                        data-topic-count="{{len .Topics}}">ðŸš« Supprimer</button>
                                </form>
                            </div>
                            
                        </div>
                    </td>
                        </tr>
                        {{end}}
                       <tr><td colspan="3"><div id="show-button" style="text-align: center;margin-top: 30px;"  class="dashboard-header">> Ajouter une catÃ©gorie</div></td></tr>
                        <tr id="newcat" class="is-hidden">

                         <form method="POST">
                            <td><input type="text" name="newcatname" class="user-edit" placeholder="Nom de la catÃ©gorie" required></td>
                           <td>
                               <textarea name="newcatdesc" class="user-edit" placeholder="Description de la catÃ©gorie"></textarea></td>
                            <td><button type="submit" title="Ajouter la nouvelle catÃ©gorie" id="add-button">âœ… Ajouter</button></td>
                            </form>
                        </tr>
                      
                    </tbody>
                </table>
            </div>


            <style>
                .catlist span {
                    display:block;
                }

                .catlist .admin-cat {
                    display:none;
                }
                
                .catlist summary{
                    color:var(--color-highlight);
                }
            </style>

            <!-- Modal de confirmation pour la suppression -->
            <div id="confirmationModal" class="modal is-hidden">
                <div class="modal-content">
                    <p>ÃŠtes-vous sÃ»r de vouloir supprimer cette catÃ©gorie ? Cela entrainera la suppression de <span id="topicCountSpan"></span> sujets.
                        Cette action est irrÃ©versible.
                    </p>
                    <div class="modal-buttons">
                        <button id="cancelDelete" class="modal-cancel-btn">Annuler</button>
                        <button id="confirmDelete" class="modal-confirm-btn">Confirmer</button>
                    </div>
                </div>
            </div>

             <script>
                document.addEventListener('DOMContentLoaded', () => {
        // Select all delete buttons
            const deleteButtons = document.querySelectorAll('.delete-btn');

        // Add a click event listener to each button
            deleteButtons.forEach(button => {
            button.addEventListener('click', (event) => {
            const topicCount = event.target.dataset.topicCount;

            if (topicCountSpan) {
                topicCountSpan.textContent = topicCount;
            }

        });
    });
});

document.addEventListener('DOMContentLoaded', () => {
        // Get the necessary elements
        const showButton = document.getElementById('show-button');
        const newCatRow = document.getElementById('newcat');
        const addButton = document.getElementById('add-button');

        // Function to show the new category row
        showButton.addEventListener('click', () => {
            newCatRow.classList.remove('is-hidden');
        });

        // Function to hide the new category row when 'Ajouter' is clicked
        addButton.addEventListener('click', (event) => {
            newCatRow.classList.add('is-hidden');
        });
    });
            </script>
</body>
</html>