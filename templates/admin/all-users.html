<!DOCTYPE html>
<html lang="fr">
   {{template "InitPage" .}}
<body>
    <!-- Header -->
   {{template "AdminHeader" .}}

    <div class="main-container">
        <!-- Sidebar -->
       {{template "AdminSidebar" .}}

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <h1>GÃ©rer les utilisateurs ({{.Stats.TotalUsers}})</h1>
            </div>

<input type="text" class="search-box" placeholder="search">

<div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nom d'utilisateur</th>
                            <th>Statut</th>
                            <th>Actions</th>
                          
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Users}}
                        <tr>
                            <form method="POST" id="edituser{{.ID}}">
                                <input type="hidden" name="userID" value="{{.ID}}">
                            <td><span class="userfield"> {{.Username}} </span><input type="text" name="username" value="{{.Username}}" class="is-hidden user-edit"></td>
                            <td> 
                               <span class="userfield">{{.Status}} </span>
                               <select name="status" class="is-hidden user-edit">
                                    <option value="Membre {{if (eq .Status "Membre")}} selected{{end}}">Membre</option>
                                    <option value="ModÃ©rateur" {{if (eq .Status "ModÃ©rateur")}} selected{{end}}>ModÃ©rateur</option>
                                    <option value="Admin" {{if (eq .Status "Admin")}} selected{{end}}>Admin</option>
                                </select>
                            <button type="submit" title="Valider les modifications" class="validate-btn is-hidden">âœ… Valider</button></td>
                            </form>
                            <td class="actions-column">
                        {{if not (eq $.CurrentUser.ID .ID)}}<div class="menu">
                            <div class="menu-options">
                                <a title="Modifier l'utilisateur" class="modifier-btn">ğŸ”§ Modifier</a>
                                <a title="Bannir l'utilisateur" href="bannuser/{{.ID}}">âš–ï¸ Bannir</a>
                                <a title="Supprimer l'utilisateur" href="deluser/{{.ID}}">ğŸš« Supprimer</a>
                            </div>
                        </div>
                        {{end}}
                    </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const modifierButtons = document.querySelectorAll('.modifier-btn');
                    const validateButtons = document.querySelectorAll('.validate-btn');

                    modifierButtons.forEach(button => {
                        button.addEventListener('click', (event) => {
                            // event.preventDefault();
                            const row = event.target.closest('tr');
                            const inputFields = row.querySelectorAll('.user-edit');
                            const validateBtn = row.querySelector('.validate-btn');
                            const modifierBtn = row.querySelector('.modifier-btn');
                            const userFields = row.querySelectorAll('.userfield');
                            
                            inputFields.forEach(input => input.classList.remove('is-hidden'));
                            if (validateBtn) validateBtn.classList.remove('is-hidden');
                            if (modifierBtn) modifierBtn.classList.add('is-hidden');
                            userFields.forEach(span => span.classList.add('is-hidden'));
                        });
                    });

                    validateButtons.forEach(button => {
                        button.addEventListener('click', (event) => {
                            // event.preventDefault();
                            const row = event.target.closest('tr');
                            const inputFields = row.querySelectorAll('.user-edit');
                            const validateBtn = row.querySelector('.validate-btn');
                            const modifierBtn = row.querySelector('.modifier-btn');
                            const userFields = row.querySelectorAll('.userfield');
                            
                            inputFields.forEach(input => input.classList.add('is-hidden'));
                            if (validateBtn) validateBtn.classList.add('is-hidden');
                            if (modifierBtn) modifierBtn.classList.remove('is-hidden');
                            userFields.forEach(span => span.classList.remove('is-hidden'));
                        });
                    });
                });
            </script>

            <style>
                .is-hidden {
                    display: none;
                }
            </style>
        </div>
    </div>
</body>
</html>