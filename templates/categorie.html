<!DOCTYPE html>
<html lang="fr">
 {{template "InitPage" .}}
  <body>
    <!-- Header -->
   {{template "ForumHeader" .}}

    <!-- Main Content -->
     <div class="dashboard-header">
  <div class="topic-top">
    <h2>{{ .Category.Name }}</h2>
     {{if .CurrentUser.LogStatus}}<form action="/new-topic" methode="GET">
       <input type="hidden" name="category_id" value="{{.Category.ID}}">
      <button type="submit" class="respond-btn">Ouvrir un nouveau sujet</button></form> {{end}}
  </div>
</div>
    <main class="main-content">
      <!-- Sidebar -->
      <aside class="sidebar">
        <h3>{{ .Category.Name }}</h3>
        <div>{{.Category.Description}}</div>
      </aside>

      <!-- Posts Section -->
      <section class="posts-section">
        {{ range .Category.Topics }}
           <!-- gt : html/template possede des fonctions integré (gt → greater than (>)) -->
        <div class="post-card">
          {{if gt (len .Messages) 0}}
    <img class="post-avatar" src="{{(index .Messages 0).Author.ProfilPic}}"/>
{{else}}
    <img class="post-avatar" src="/static/default-avatar.png"/>
{{end}}
     
          <div class="post-content">
            <a class="post-title" href="/topic/{{.TopicID}}">{{.Name}}</a>
            <div class="post-author">Dernier message par <a href="/user/{{(index .Messages .LastPost).Author.ID}}">{{(index .Messages .LastPost).Author.Username}}</a></div>
            <pre class="post-text">{{preview (index .Messages .LastPost).Content 300}}</pre>
          </div>
        </div>
        {{else}}
         <div class="post-card">
          <div class="post-content">
            <div class="post-text">
              Cette catégorie ne contient pour l'instant aucun sujet.
            </div>
          </div>
        </div>
        {{end}}
      </section>
    </main>
  </body>
</html>
</html>
