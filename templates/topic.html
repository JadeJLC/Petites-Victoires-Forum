<!DOCTYPE html>
<html lang="fr">
{{template "InitPage" .}}
<body>
    <!-- Header -->
   {{template "ForumHeader" .}}

<!-- Main Content -->
<div class="dashboard-header">
  <div class="topic-top">
    <h2>{{.Topic.Name}}</h2>
     {{if .CurrentUser.LogStatus}}<button class="respond-btn" onclick="showResponseBox(this)">RÃ©pondre</button>{{end}}
  </div>
</div>

<main class="main-content">

    <!-- Sidebar -->
      <aside class="sidebar">
        {{range .Topic.Messages}}
        â€¢ <a href="#{{.MessageID}}">Message du {{.Created}}</a> par {{.Author.Username}}
      <br>
      {{end}}
      </aside>

  <!-- Posts Section -->
   
        <section class="posts-section">
            {{range .Topic.Messages}}
            <div class="post-card 
            {{if or (eq $.CurrentUser.UserType 1) (eq $.CurrentUser.UserType 2) (eq $.CurrentUser.ID .Author.ID)}} {{if eq .Warning 1}} warning {{end}} {{end}}"
             id="{{.MessageID}}" >
                <img class="post-avatar" src="{{.Author.ProfilPic}}"/>
                <div class="post-content">
                    <div class="post-title">{{.Author.Username}}</div>
                    <pre class="post-text">
{{.Content}}</pre>
                <div class="post-actions">
                            <form method="POST" action="/messageactions">
                                <input type="hidden" name="postID" value="{{.MessageID}}">
                                <input type="hidden" name="topicID" value="{{$.Topic.TopicID}}">
                               {{if eq $.CurrentUser.UserType 1}} <button name="action" style=" cursor:pointer;" type="submit" value ="delete" title="Supprimer le message">ğŸ—‘ï¸</button> 
                               {{if eq .Warning 1}} <button name="action" style="cursor:pointer;" type="submit" value="cancel" title="Annuler le signalement">ğŸ”•</button> {{end}}
                               {{end}}
                               
                    {{if eq $.CurrentUser.UserType 2}} 
                    {{if eq .Warning 0}} <button name="action" style="cursor:pointer;" type="submit" value="warn" title="Signaler le message">âš ï¸</button> {{end}} 
                    {{end}}
                   
                               {{if or (eq $.CurrentUser.UserType 1) (eq $.CurrentUser.UserType 2) (eq $.CurrentUser.ID .Author.ID)}} 
                               <button name="action" style="cursor: pointer;" type="submit" value="edit" title="Modifier le message">ğŸ“</button> {{end}}
                            </form>
                </div>
                </div>

            {{if or (eq $.CurrentUser.UserType 1) (eq $.CurrentUser.UserType 2) (eq $.CurrentUser.ID .Author.ID)}}    
                {{if eq .Warning 1}} <span style="cursor:default" title="Ce message a Ã©tÃ© signalÃ© comme potentiellement problÃ©matique">â€¼ï¸</span>  {{end}}
            {{end}}
                {{if $.CurrentUser.LogStatus}}<div class="action-column">
                   <form method="POST" action="/like" class="like-form">
            <input type="hidden" name="postID" value="{{.MessageID}}">
            <button type="submit" class="action-btn">
                <span>ğŸ‘</span>
                <span>{{.Likes}}</span>
            </button>
                    </form>
                    <form method="POST" action="/dislike" class="like-form">
            <input type="hidden" name="postID" value="{{.MessageID}}">
            <button type="submit" class="action-btn">
                <span>ğŸ‘</span>
                <span>{{.Dislikes}}</span>
            </button>
                    </form>
                    
                </div>
                {{else }}
                <div>
                  <span>ğŸ‘</span>
                <span>{{.Likes}}</span>
                </div>
                <div> <span>ğŸ‘</span>
                <span>{{.Dislikes}}</span></div>
                {{end}}
            </div>
            {{end}}

        </section>
        </main>
    </div>

    <!-- Modal de rÃ©ponse -->
   {{template "ReponseBox"}}


   <style>.posts-section .post-card:first-child {
  /* border-bottom:10px solid var(--color-highlight); */
  border-left:7px solid var(--color-highlight);
  margin-bottom: 25px;
}</style>
     

    <script>       
        // Animation au scroll
        window.addEventListener('scroll', () => {
            const posts = document.querySelectorAll('.post');
            posts.forEach(post => {
                const rect = post.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    post.style.opacity = '1';
                    post.style.transform = 'translateY(0)';
                }
            });
        });

        // Recherche en temps rÃ©el (simulation)
        document.querySelector('.search-bar').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const posts = document.querySelectorAll('.post');
            
            posts.forEach(post => {
                const content = post.querySelector('.post-content').textContent.toLowerCase();
                const username = post.querySelector('.username').textContent.toLowerCase();
                
                if (content.includes(query) || username.includes(query) || query === '') {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            });
        });

    </script>
</body>
</html>
